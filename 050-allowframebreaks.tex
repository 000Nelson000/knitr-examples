\documentclass{beamer}\usepackage{graphicx, color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\definecolor{fgcolor}{rgb}{0.2, 0.2, 0.2}
\newcommand{\hlnumber}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlfunctioncall}[1]{\textcolor[rgb]{0.501960784313725,0,0.329411764705882}{\textbf{#1}}}%
\newcommand{\hlstring}[1]{\textcolor[rgb]{0.6,0.6,1}{#1}}%
\newcommand{\hlkeyword}[1]{\textcolor[rgb]{0,0,0}{\textbf{#1}}}%
\newcommand{\hlargument}[1]{\textcolor[rgb]{0.690196078431373,0.250980392156863,0.0196078431372549}{#1}}%
\newcommand{\hlcomment}[1]{\textcolor[rgb]{0.180392156862745,0.6,0.341176470588235}{#1}}%
\newcommand{\hlroxygencomment}[1]{\textcolor[rgb]{0.43921568627451,0.47843137254902,0.701960784313725}{#1}}%
\newcommand{\hlformalargs}[1]{\textcolor[rgb]{0.690196078431373,0.250980392156863,0.0196078431372549}{#1}}%
\newcommand{\hleqformalargs}[1]{\textcolor[rgb]{0.690196078431373,0.250980392156863,0.0196078431372549}{#1}}%
\newcommand{\hlassignement}[1]{\textcolor[rgb]{0,0,0}{\textbf{#1}}}%
\newcommand{\hlpackage}[1]{\textcolor[rgb]{0.588235294117647,0.709803921568627,0.145098039215686}{#1}}%
\newcommand{\hlslot}[1]{\textit{#1}}%
\newcommand{\hlsymbol}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlprompt}[1]{\textcolor[rgb]{0.2,0.2,0.2}{#1}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}

\title{Test framebreaks}
\author{Yihui Xie}
\begin{document}

\maketitle



\begin{frame}[allowframebreaks,fragile]
\frametitle{Preliminaries}
\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}
\begin{alltt}
\hlfunctioncall{example}(step)
\end{alltt}
\begin{verbatim}
## 
## step> ## No test: 
## step> ## following on from example(lm)
## step> ## Don't show: 
## step> utils::example("lm", echo = FALSE)

## 
## step> ## End Don't show
## step> step(lm.D9)  
## Start:  AIC=-12.58
## weight ~ group
## 
##         Df Sum of Sq  RSS   AIC
## - group  1     0.688 9.42 -13.1
## <none>               8.73 -12.6
## 
## Step:  AIC=-13.06
## weight ~ 1
## 
## 
## Call:
## lm(formula = weight ~ 1)
## 
## Coefficients:
## (Intercept)  
##        4.85  
## 
## 
## step> summary(lm1 <- lm(Fertility ~ ., data = swiss))
## 
## Call:
## lm(formula = Fertility ~ ., data = swiss)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.274  -5.262   0.503   4.120  15.321 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(>|t|)    
## (Intercept)       66.9152    10.7060    6.25  1.9e-07 ***
## Agriculture       -0.1721     0.0703   -2.45   0.0187 *  
## Examination       -0.2580     0.2539   -1.02   0.3155    
## Education         -0.8709     0.1830   -4.76  2.4e-05 ***
## Catholic           0.1041     0.0353    2.95   0.0052 ** 
## Infant.Mortality   1.0770     0.3817    2.82   0.0073 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
## 
## Residual standard error: 7.17 on 41 degrees of freedom
## Multiple R-squared: 0.707,	Adjusted R-squared: 0.671 
## F-statistic: 19.8 on 5 and 41 DF,  p-value: 5.59e-10 
## 
## 
## step> slm1 <- step(lm1)
## Start:  AIC=190.7
## Fertility ~ Agriculture + Examination + Education + Catholic + 
##     Infant.Mortality
## 
##                    Df Sum of Sq  RSS AIC
## - Examination       1        53 2158 190
## <none>                          2105 191
## - Agriculture       1       308 2413 195
## - Infant.Mortality  1       409 2514 197
## - Catholic          1       448 2553 198
## - Education         1      1163 3268 209
## 
## Step:  AIC=189.9
## Fertility ~ Agriculture + Education + Catholic + Infant.Mortality
## 
##                    Df Sum of Sq  RSS AIC
## <none>                          2158 190
## - Agriculture       1       264 2422 193
## - Infant.Mortality  1       410 2568 196
## - Catholic          1       957 3115 205
## - Education         1      2250 4408 221
## 
## step> summary(slm1)
## 
## Call:
## lm(formula = Fertility ~ Agriculture + Education + Catholic + 
##     Infant.Mortality, data = swiss)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -14.676  -6.052   0.751   3.166  16.142 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(>|t|)    
## (Intercept)       62.1013     9.6049    6.47  8.5e-08 ***
## Agriculture       -0.1546     0.0682   -2.27   0.0286 *  
## Education         -0.9803     0.1481   -6.62  5.1e-08 ***
## Catholic           0.1247     0.0289    4.31  9.5e-05 ***
## Infant.Mortality   1.0784     0.3819    2.82   0.0072 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
## 
## Residual standard error: 7.17 on 42 degrees of freedom
## Multiple R-squared: 0.699,	Adjusted R-squared: 0.671 
## F-statistic: 24.4 on 4 and 42 DF,  p-value: 1.72e-10 
## 
## 
## step> slm1$anova
##            Step Df Deviance Resid. Df Resid. Dev   AIC
## 1               NA       NA        41       2105 190.7
## 2 - Examination  1    53.03        42       2158 189.9
## 
## step> ## End(No test)
## step> 
## step>
\end{verbatim}
\includegraphics[width=\maxwidth]{figure/050-allowframebreaks-step0} 
\end{knitrout}

\end{frame}

\end{document}
